# 车辆速度检测移动App

这是一个基于Kivy框架开发的移动端车辆速度检测应用，可以在手机上运行，无需服务器。

## 功能特性

- 📱 **移动端运行**：基于Kivy框架，支持Android和iOS
- 🎥 **实时摄像头访问**：直接使用手机摄像头进行实时检测
- 🚗 **车辆检测**：使用YOLOv8模型检测车辆
- 📊 **多目标跟踪**：使用Kalman滤波算法进行稳定的多目标跟踪
- ⚡ **速度计算**：实时计算车辆速度（km/h）
- 🎨 **可视化显示**：实时显示检测框、轨迹和速度信息

## 安装要求

### Python环境
- Python 3.7+
- pip

### 依赖安装

```bash
pip install -r requirements.txt
```

注意：首次运行会自动下载YOLOv8模型文件（yolov8n.pt），约6MB。

## 使用方法

### 在PC上运行（测试）

```bash
python app.py
```

### 在Android上运行

1. **使用Buildozer打包（推荐）**

```bash
# 安装buildozer
pip install buildozer

# 初始化buildozer配置（如果还没有buildozer.spec文件）
buildozer init

# 打包APK
buildozer android debug
```

打包完成后，APK文件位于 `bin/` 目录下。

2. **使用Python-for-Android**

参考Kivy官方文档进行打包。

### 在iOS上运行

使用Kivy iOS工具链进行打包，参考Kivy官方文档。

## 使用说明

### 基本操作

1. **启动应用**：运行app.py
2. **开始检测**：点击"开始检测"按钮，应用会打开摄像头
3. **停止检测**：点击"停止检测"按钮

### 速度标定

为了准确计算车辆速度，需要进行标定：

1. 点击"标定"按钮
2. 在画面中测量一个已知实际距离的物体（例如：已知长度的道路标线）
3. 输入实际距离（米）和对应的像素距离
4. 点击"确定"完成标定

**标定建议**：
- 选择一个已知长度的参考物（如标准车道宽度3.75米）
- 确保参考物与车辆在同一平面上
- 标定后保持手机位置相对固定

### 设置

点击"设置"按钮可以调整：
- 帧率：默认30 FPS，可根据设备性能调整

## 技术架构

- **UI框架**：Kivy 2.1.0+
- **计算机视觉**：OpenCV
- **目标检测**：YOLOv8 (Ultralytics)
- **多目标跟踪**：Kalman滤波
- **速度计算**：基于像素位移和帧率计算

## 注意事项

1. **摄像头权限**：首次运行时需要授予摄像头访问权限
2. **性能优化**：在低端设备上可能需要降低检测频率或使用更小的YOLO模型
3. **标定精度**：速度计算的准确性取决于标定的准确性
4. **光照条件**：在光线充足的环境下效果更好
5. **设备兼容性**：某些设备可能需要调整摄像头索引（代码中已包含自动检测）

## 故障排除

### 摄像头无法打开
- 检查是否授予了摄像头权限
- 尝试重启应用
- 检查其他应用是否占用摄像头

### 检测不准确
- 确保光线充足
- 调整标定参数
- 检查摄像头是否对焦

### 性能问题
- 降低帧率设置
- 使用更小的YOLO模型（yolov8n.pt已是最小模型）
- 关闭其他应用释放内存

## 开发说明

### 项目结构

```
Kalman/
├── app.py              # 主应用文件
├── kalman.py           # Kalman滤波实现
├── matcher.py          # 数据关联匹配
├── utils.py            # 工具函数
├── const.py            # 常量定义
├── measure.py          # 测量相关
└── requirements.txt    # 依赖列表
```

### 自定义修改

- **检测类别**：在`app.py`的`update_frame`方法中修改`classes`参数
  - 2: 汽车
  - 3: 摩托车
  - 5: 公交车
  - 7: 卡车
- **检测阈值**：修改`conf`和`iou`参数
- **速度计算**：在`SpeedCalculator`类中调整计算逻辑

## 许可证

请查看LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request！

