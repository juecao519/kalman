# è½¦è¾†é€Ÿåº¦æ£€æµ‹App - äº‘æ‰“åŒ…æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†é¡¹ç›®æ‰“åŒ…æˆç¦»çº¿Android/iOSåº”ç”¨ï¼Œæ”¯æŒå¤šç§äº‘æ‰“åŒ…æ–¹æ¡ˆã€‚

## ğŸ“‹ ç›®å½•

1. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
2. [æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨GitHub Actionsäº‘æ‰“åŒ…ï¼ˆæ¨èï¼‰](#æ–¹æ¡ˆä¸€ä½¿ç”¨github-actionsäº‘æ‰“åŒ…æ¨è)
3. [æ–¹æ¡ˆäºŒï¼šä½¿ç”¨GitLab CI/CDäº‘æ‰“åŒ…](#æ–¹æ¡ˆäºŒä½¿ç”¨gitlab-cicdäº‘æ‰“åŒ…)
4. [æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹äº‘æ‰“åŒ…æœåŠ¡](#æ–¹æ¡ˆä¸‰ä½¿ç”¨ç¬¬ä¸‰æ–¹äº‘æ‰“åŒ…æœåŠ¡)
5. [æ–¹æ¡ˆå››ï¼šä½¿ç”¨Dockerå®¹å™¨æœ¬åœ°æ‰“åŒ…](#æ–¹æ¡ˆå››ä½¿ç”¨dockerå®¹å™¨æœ¬åœ°æ‰“åŒ…)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å‡†å¤‡å·¥ä½œ

### 1. ç¡®ä¿é¡¹ç›®æ–‡ä»¶å®Œæ•´

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
- âœ… `app.py` - ä¸»åº”ç”¨æ–‡ä»¶
- âœ… `buildozer.spec` - Buildozeré…ç½®æ–‡ä»¶
- âœ… `yolov8n.pt` - YOLOæ¨¡å‹æ–‡ä»¶ï¼ˆå¿…é¡»åŒ…å«åœ¨APKä¸­ï¼‰
- âœ… `requirements.txt` - Pythonä¾èµ–
- âœ… æ‰€æœ‰å¿…è¦çš„Pythonæ¨¡å—ï¼ˆkalman.py, matcher.py, utils.py, const.py, measure.pyï¼‰

### 2. æ£€æŸ¥buildozer.specé…ç½®

å·²ä¼˜åŒ–çš„é…ç½®åŒ…æ‹¬ï¼š
- âœ… æ¨¡å‹æ–‡ä»¶ï¼ˆ.ptï¼‰å·²åŒ…å«åœ¨ `source.include_exts`
- âœ… Androidæƒé™å·²é…ç½®ï¼ˆæ‘„åƒå¤´ã€å­˜å‚¨ç­‰ï¼‰
- âœ… ä¾èµ–åŒ…å·²æ­£ç¡®åˆ—å‡º

---

## æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨GitHub Actionsäº‘æ‰“åŒ…ï¼ˆæ¨èï¼‰

### ä¼˜ç‚¹
- âœ… å®Œå…¨å…è´¹ï¼ˆå…¬å¼€ä»“åº“ï¼‰
- âœ… è‡ªåŠ¨åŒ–æ„å»º
- âœ… æ”¯æŒå¤šæ¶æ„ï¼ˆarm64-v8a, armeabi-v7aï¼‰
- âœ… è‡ªåŠ¨ç”ŸæˆAPKä¸‹è½½é“¾æ¥

### æ­¥éª¤

#### 1. åˆ›å»ºGitHubä»“åº“å¹¶æ¨é€ä»£ç 

```bash
# åˆå§‹åŒ–gitä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init
git add .
git commit -m "Initial commit"

# åˆ›å»ºGitHubä»“åº“åï¼Œæ·»åŠ è¿œç¨‹ä»“åº“
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å.git
git push -u origin main
```

#### 2. åˆ›å»ºGitHub Actionså·¥ä½œæµ

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.github/workflows/build-apk.yml` æ–‡ä»¶ï¼š

```yaml
name: Build Android APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install system dependencies
      run: |
        sudo apt update
        sudo apt install -y git zip unzip openjdk-11-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
        
    - name: Install Buildozer
      run: |
        pip install buildozer cython
        
    - name: Build APK
      working-directory: ./Kalman
      run: |
        buildozer android debug
        # æˆ–è€…ä½¿ç”¨ release ç‰ˆæœ¬ï¼ˆéœ€è¦é…ç½®ç­¾åï¼‰
        # buildozer android release
        
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: app-debug
        path: Kalman/bin/*.apk
        retention-days: 30
```

#### 3. æäº¤å¹¶æ¨é€

```bash
git add .github/workflows/build-apk.yml
git commit -m "Add GitHub Actions workflow for APK build"
git push
```

#### 4. æŸ¥çœ‹æ„å»ºç»“æœ

1. è¿›å…¥GitHubä»“åº“é¡µé¢
2. ç‚¹å‡» "Actions" æ ‡ç­¾
3. é€‰æ‹©æœ€æ–°çš„å·¥ä½œæµè¿è¡Œ
4. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦20-40åˆ†é’Ÿï¼‰
5. åœ¨ "Artifacts" éƒ¨åˆ†ä¸‹è½½APKæ–‡ä»¶

### ä¼˜åŒ–å»ºè®®

å¦‚æœéœ€è¦æ›´å¿«çš„æ„å»ºï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼š

```yaml
- name: Cache Buildozer dependencies
  uses: actions/cache@v3
  with:
    path: |
      ~/.buildozer
      ~/.android
    key: ${{ runner.os }}-buildozer-${{ hashFiles('Kalman/buildozer.spec') }}
    restore-keys: |
      ${{ runner.os }}-buildozer-
```

---

## æ–¹æ¡ˆäºŒï¼šä½¿ç”¨GitLab CI/CDäº‘æ‰“åŒ…

### æ­¥éª¤

#### 1. åˆ›å»º `.gitlab-ci.yml` æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºï¼š

```yaml
image: ubuntu:22.04

variables:
  ANDROID_SDK_VERSION: "30"
  ANDROID_NDK_VERSION: "23b"

before_script:
  - apt-get update -qq
  - apt-get install -y -qq git zip unzip openjdk-11-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
  - pip3 install buildozer cython

build:
  stage: build
  script:
    - cd Kalman
    - buildozer android debug
  artifacts:
    paths:
      - Kalman/bin/*.apk
    expire_in: 30 days
  only:
    - main
    - master
```

#### 2. æ¨é€ä»£ç åˆ°GitLab

```bash
git remote add gitlab https://gitlab.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å.git
git push gitlab main
```

---

## æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹äº‘æ‰“åŒ…æœåŠ¡

### é€‰é¡¹Aï¼šAppVeyorï¼ˆWindows/Linuxæ„å»ºï¼‰

1. æ³¨å†Œ [AppVeyor](https://www.appveyor.com/)
2. è¿æ¥GitHub/GitLabä»“åº“
3. åˆ›å»º `appveyor.yml`ï¼š

```yaml
image: Ubuntu2204

build_script:
  - sudo apt-get update
  - sudo apt-get install -y git zip unzip openjdk-11-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
  - pip3 install buildozer cython
  - cd Kalman
  - buildozer android debug

artifacts:
  - path: Kalman/bin/*.apk
    name: APK
```

### é€‰é¡¹Bï¼šCircleCI

1. æ³¨å†Œ [CircleCI](https://circleci.com/)
2. è¿æ¥GitHubä»“åº“
3. åˆ›å»º `.circleci/config.yml`ï¼š

```yaml
version: 2.1

jobs:
  build:
    docker:
      - image: cimg/python:3.9
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            sudo apt-get update
            sudo apt-get install -y git zip unzip openjdk-11-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
      - run:
          name: Install Buildozer
          command: |
            pip install buildozer cython
      - run:
          name: Build APK
          working_directory: Kalman
          command: buildozer android debug
      - store_artifacts:
          path: Kalman/bin
```

---

## æ–¹æ¡ˆå››ï¼šä½¿ç”¨Dockerå®¹å™¨æœ¬åœ°æ‰“åŒ…

å¦‚æœä¸æƒ³ä½¿ç”¨äº‘æœåŠ¡ï¼Œå¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨Dockeræ‰“åŒ…ã€‚

### æ­¥éª¤

#### 1. åˆ›å»º Dockerfile

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    git zip unzip openjdk-11-jdk python3-pip \
    autoconf libtool pkg-config zlib1g-dev \
    libncurses5-dev libncursesw5-dev libtinfo5 \
    cmake libffi-dev libssl-dev && \
    rm -rf /var/lib/apt/lists/*

RUN pip3 install buildozer cython

WORKDIR /app
COPY . .

WORKDIR /app/Kalman

CMD ["buildozer", "android", "debug"]
```

#### 2. æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºDockeré•œåƒ
docker build -t kalman-builder .

# è¿è¡Œæ„å»ºï¼ˆåœ¨å½“å‰ç›®å½•ç”Ÿæˆbinæ–‡ä»¶å¤¹ï¼‰
docker run --rm -v "$(pwd)/Kalman:/app/Kalman" kalman-builder

# APKæ–‡ä»¶ä¼šåœ¨ Kalman/bin/ ç›®å½•ä¸‹
```

---

## æ–¹æ¡ˆäº”ï¼šä½¿ç”¨åœ¨çº¿BuildozeræœåŠ¡

### BeeWare Briefcaseï¼ˆæ¨èç”¨äºiOSï¼‰

è™½ç„¶ä¸»è¦æ”¯æŒiOSï¼Œä½†ä¹Ÿå¯ä»¥ç”¨äºAndroidï¼š

```bash
pip install briefcase

# åˆå§‹åŒ–
briefcase create android

# æ„å»º
briefcase build android

# æ‰“åŒ…
briefcase package android
```

---

## å¸¸è§é—®é¢˜

### Q1: æ„å»ºå¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°yolov8n.pt

**è§£å†³æ–¹æ¡ˆï¼š**
ç¡®ä¿ `buildozer.spec` ä¸­ `source.include_exts` åŒ…å« `pt` æ‰©å±•åï¼š
```ini
source.include_exts = py,png,jpg,jpeg,atlas,json,txt,pt
```

å¹¶ä¸”ç¡®ä¿ `yolov8n.pt` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `app.py` åŒçº§ï¼‰ã€‚

### Q2: æ„å»ºæ—¶é—´å¤ªé•¿

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ç¼“å­˜ï¼ˆGitHub Actionsç¤ºä¾‹ä¸­å·²åŒ…å«ï¼‰
2. åªæ„å»ºä¸€ä¸ªæ¶æ„ï¼šåœ¨ `buildozer.spec` ä¸­è®¾ç½® `android.archs = arm64-v8a`
3. ä½¿ç”¨é¢„ç¼–è¯‘çš„ä¾èµ–

### Q3: APKæ–‡ä»¶å¤ªå¤§

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ `buildozer android release` è€Œä¸æ˜¯ `debug`ï¼ˆä¼šè‡ªåŠ¨ä¼˜åŒ–ï¼‰
2. æ£€æŸ¥æ˜¯å¦åŒ…å«äº†ä¸å¿…è¦çš„æ–‡ä»¶
3. ä½¿ç”¨ProGuardè¿›è¡Œä»£ç æ··æ·†ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰

### Q4: äº‘æ„å»ºç¯å¢ƒç¼ºå°‘ä¾èµ–

**è§£å†³æ–¹æ¡ˆï¼š**
åœ¨CIé…ç½®æ–‡ä»¶ä¸­ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ç³»ç»Ÿä¾èµ–ï¼š
- Java JDK
- Android SDK/NDKï¼ˆBuildozerä¼šè‡ªåŠ¨ä¸‹è½½ï¼Œä½†éœ€è¦é…ç½®ï¼‰
- ç¼–è¯‘å·¥å…·é“¾

### Q5: å¦‚ä½•ç­¾åAPKç”¨äºå‘å¸ƒï¼Ÿ

**æ­¥éª¤ï¼š**

1. ç”Ÿæˆå¯†é’¥åº“ï¼š
```bash
keytool -genkey -v -keystore my-release-key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias my-key-alias
```

2. åœ¨ `buildozer.spec` ä¸­é…ç½®ï¼š
```ini
android.keystore = my-release-key.jks
android.keystore_password = ä½ çš„å¯†ç 
android.keyalias = my-key-alias
android.keyalias_password = ä½ çš„å¯†ç 
```

3. æ„å»ºå‘å¸ƒç‰ˆæœ¬ï¼š
```bash
buildozer android release
```

### Q6: å¦‚ä½•ä¸ºiOSæ‰“åŒ…ï¼Ÿ

iOSæ‰“åŒ…éœ€è¦macOSç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ï¼š

1. **GitHub Actions macOS Runner**ï¼ˆéœ€è¦ä»˜è´¹è´¦æˆ·ï¼‰
2. **MacStadium** æˆ– **MacinCloud** ç­‰macOSäº‘æœåŠ¡
3. **æœ¬åœ°macOSè®¾å¤‡**

---

## æ¨èæ–¹æ¡ˆæ€»ç»“

| æ–¹æ¡ˆ | éš¾åº¦ | æˆæœ¬ | æ¨èåº¦ |
|------|------|------|--------|
| GitHub Actions | â­â­ | å…è´¹ | â­â­â­â­â­ |
| GitLab CI/CD | â­â­ | å…è´¹ | â­â­â­â­ |
| Dockeræœ¬åœ° | â­â­â­ | å…è´¹ | â­â­â­ |
| ç¬¬ä¸‰æ–¹æœåŠ¡ | â­â­ | éƒ¨åˆ†å…è´¹ | â­â­â­ |

**æœ€ä½³é€‰æ‹©ï¼šGitHub Actions** - å…è´¹ã€è‡ªåŠ¨åŒ–ã€æ˜“äºä½¿ç”¨ã€‚

---

## ä¸‹ä¸€æ­¥

1. é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆ
2. æŒ‰ç…§æ­¥éª¤é…ç½®
3. ç­‰å¾…æ„å»ºå®Œæˆ
4. ä¸‹è½½APKå¹¶å®‰è£…åˆ°æ‰‹æœºæµ‹è¯•

**æ³¨æ„ï¼š** é¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦20-40åˆ†é’Ÿï¼Œå› ä¸ºéœ€è¦ä¸‹è½½Android SDKå’Œç¼–è¯‘æ‰€æœ‰ä¾èµ–ã€‚åç»­æ„å»ºä¼šæ›´å¿«ï¼ˆå¦‚æœä½¿ç”¨äº†ç¼“å­˜ï¼‰ã€‚

---

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. `buildozer.spec` é…ç½®æ˜¯å¦æ­£ç¡®
2. æ‰€æœ‰ä¾èµ–æ–‡ä»¶æ˜¯å¦åŒ…å«
3. CI/CDæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
4. Buildozerå®˜æ–¹æ–‡æ¡£ï¼šhttps://buildozer.readthedocs.io/

